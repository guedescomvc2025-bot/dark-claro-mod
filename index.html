<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark ClaroTV Mod</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
    <style>
        /* Variáveis CSS */
        :root {
            --primary-color: #e50914;
            --secondary-color: #141414;
            --background-color: #0f0f0f;
            --surface-color: #1a1a1a;
            --text-color: #ffffff;
            --text-secondary: #b3b3b3;
            --border-color: #333333;
            --hover-color: #2a2a2a;
            --success-color: #46d369;
            --error-color: #e87c03;
            --header-height: 70px;
            --footer-height: 40px;
            --nav-width: 200px;
        }
        /* Reset e Estilos Globais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }
        /* Telas */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            display: none;
            flex-direction: column;
        }
        .screen.active {
            display: flex;
        }
        /* Tela de Login */
        .login-container {
            max-width: 500px;
            margin: auto;
            padding: 2rem;
            background-color: var(--surface-color);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            width: 90%;
        }
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .login-header h1 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
        }
        .login-header p {
            color: var(--text-secondary);
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        .btn-primary {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #c40812;
        }
        .login-footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        /* Cabeçalho Principal */
        .main-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-left {
            display: flex;
            align-items: center;
        }
        .app-title {
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: 700;
        }
        .header-center {
            flex: 1;
            max-width: 500px;
            margin: 0 1rem;
        }
        .search-container {
            position: relative;
            width: 100%;
        }
        .search-container input {
            width: 100%;
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-color);
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }
        .search-container input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        .search-container button {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
        }
        .header-right {
            display: flex;
            gap: 1rem;
        }
        .icon-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        .icon-btn:hover {
            color: var(--primary-color);
        }
        /* Conteúdo Principal */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding-bottom: var(--footer-height);
        }
        /* Menu de Navegação */
        .nav-menu {
            display: flex;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .nav-menu::-webkit-scrollbar {
            display: none;
        }
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            margin-right: 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s;
            white-space: nowrap;
        }
        .nav-btn i {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }
        .nav-btn span {
            font-size: 0.8rem;
        }
        .nav-btn.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }
        .nav-btn:hover {
            color: var(--primary-color);
        }
        /* Conteúdo por Categoria */
        .content-container {
            flex: 1;
            padding: 1.5rem 2rem;
        }
        .content-section {
            margin-bottom: 2rem;
        }
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }
        .category-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .category-filters::-webkit-scrollbar {
            display: none;
        }
        .category-btn {
            padding: 0.4rem 0.8rem;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }
        .category-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .category-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 1rem;
        }
        .content-card {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--surface-color);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            aspect-ratio: 16/9;
        }
        .content-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        .content-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .content-card .content-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 0.5rem;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            color: white;
        }
        .content-card .content-title {
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .content-card .content-meta {
            font-size: 0.7rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .content-card .favorite-icon {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .content-card:hover .favorite-icon {
            opacity: 1;
        }
        .content-card .favorite-icon.active {
            opacity: 1;
            color: var(--primary-color);
        }
        /* Rodapé */
        .main-footer {
            display: flex;
            align-items: center;
            justify-content: center;
            height: var(--footer-height);
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        /* Tela do Player */
        .player-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .player-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
        }
        .player-header h2 {
            font-size: 1.2rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70%;
        }
        .player-content {
            flex: 1;
            position: relative;
            background-color: #000;
        }
        #player-container {
            width: 100%;
            height: 100%;
        }
        .player-info {
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            padding: 1rem;
            max-height: 40%;
            overflow-y: auto;
        }
        .info-container h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        #content-details {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 0.5rem 1rem;
            margin-bottom: 1rem;
        }
        #content-details dt {
            color: var(--text-secondary);
        }
        #content-details dd {
            margin: 0;
        }
        .player-controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .quality-selector, .season-episode-selector {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .quality-selector select, .season-episode-selector select {
            padding: 0.5rem;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-color);
            font-size: 0.9rem;
            flex: 1;
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background-color: var(--surface-color);
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        .close-modal {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .modal-body {
            padding: 1rem;
        }
        .modal-body p {
            margin-bottom: 1rem;
        }
        /* Modal de Episódios da Série */
        #series-episodes-modal .modal-content {
            max-width: 800px;
            max-height: 90vh;
        }
        .season-section {
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        .season-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: var(--background-color);
            cursor: pointer;
        }
        .season-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }
        .toggle-season-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 1rem;
        }
        .episodes-container {
            padding: 0.75rem;
            background-color: var(--surface-color);
        }
        .episode-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: var(--background-color);
            border-radius: 4px;
        }
        .episode-info h4 {
            margin: 0 0 0.25rem 0;
            font-size: 1rem;
        }
        .episode-info p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        .play-episode-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .play-episode-btn:hover {
            background-color: #c40812;
        }
        /* Modal de Qualidade */
        .quality-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
        }
        .quality-btn {
            padding: 0.75rem;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s;
        }
        .quality-btn:hover {
            background-color: var(--hover-color);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        /* Classes de utilidade */
        .hidden {
            display: none !important;
        }
        /* Responsividade */
        @media (max-width: 768px) {
            .app-title {
                font-size: 1.2rem;
            }
            
            .header-center {
                margin: 0 0.5rem;
            }
            
            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .content-card .content-title {
                font-size: 0.8rem;
            }
            
            .content-card .content-meta {
                font-size: 0.6rem;
            }
        }
        @media (max-width: 480px) {
            .main-header {
                padding: 0.5rem 1rem;
            }
            
            .header-right {
                gap: 0.5rem;
            }
            
            .nav-menu {
                padding: 0.5rem 1rem;
            }
            
            .nav-btn {
                padding: 0.3rem 0.6rem;
                margin-right: 0.5rem;
            }
            
            .content-container {
                padding: 1rem;
            }
            
            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 0.5rem;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
            
            .player-info {
                max-height: 50%;
            }
        }
        /* Estilos para o Plyr */
        .plyr {
            width: 100%;
            height: 100%;
        }
        .plyr__video-wrapper {
            background-color: #000;
        }
        .plyr--full-ui input[type="range"] {
            color: var(--primary-color);
        }
        .plyr__control--overlaid {
            background-color: var(--primary-color);
        }
        .plyr__control:hover {
            background-color: var(--primary-color);
        }
        .plyr__menu__container {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
        }
        .plyr__menu__label {
            color: var(--text-color);
        }
        .plyr__control.plyr__tab-focus {
            outline-color: var(--primary-color);
        }
        /* Classes para ajuste de aspecto */
        .video-fit {
            object-fit: contain;
        }
        .video-fill {
            object-fit: fill;
        }
        .video-zoom {
            object-fit: cover;
        }
        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Mensagem de erro */
        .error-message {
            color: var(--error-color);
            text-align: center;
            padding: 1rem;
            background-color: rgba(232, 124, 3, 0.1);
            border-radius: 4px;
            margin: 1rem 0;
        }
        /* Melhorias de performance */
        .lazy-load {
            opacity: 0;
            transition: opacity 0.3s;
        }
        .lazy-load.loaded {
            opacity: 1;
        }
        /* Estilos para informações do TMDB */
        .tmdb-info {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
        .tmdb-rating {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .tmdb-rating i {
            color: #f5c518;
            margin-right: 0.5rem;
        }
        .tmdb-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .tmdb-genre-tag {
            background-color: var(--hover-color);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <h1>Dark ClaroTV Mod</h1>
                <p>Conecte-se à sua conta Xtream Codes</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="server-url">URL do Servidor</label>
                    <input type="text" id="server-url" placeholder="http://exemplo.com" required>
                </div>
                <div class="form-group">
                    <label for="username">Usuário</label>
                    <input type="text" id="username" placeholder="Seu usuário" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Sua senha" required>
                </div>
                <div class="form-group">
                    <label for="tmdb-api-key">Chave da API TMDB (opcional)</label>
                    <input type="text" id="tmdb-api-key" placeholder="Sua chave da API TMDB">
                </div>
                <button type="submit" class="btn-primary">Conectar</button>
            </form>
            <div class="login-footer">
                <p>Feito por Dark Mensageiro</p>
            </div>
        </div>
    </div>
    <!-- Tela Principal -->
    <div id="main-screen" class="screen">
        <!-- Cabeçalho -->
        <header class="main-header">
            <div class="header-left">
                <h1 class="app-title">Dark ClaroTV Mod</h1>
            </div>
            <div class="header-center">
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Pesquisar conteúdo...">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div class="header-right">
                <button id="info-btn" class="icon-btn" title="Informações">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button id="add-account-btn" class="icon-btn" title="Adicionar Conta">
                    <i class="fas fa-plus-circle"></i>
                </button>
                <button id="logout-btn" class="icon-btn" title="Desconectar">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>
        <!-- Conteúdo Principal -->
        <main class="main-content">
            <!-- Menu de Navegação -->
            <nav class="nav-menu">
                <button class="nav-btn active" data-category="live">
                    <i class="fas fa-tv"></i>
                    <span>Canais</span>
                </button>
                <button class="nav-btn" data-category="vod">
                    <i class="fas fa-film"></i>
                    <span>Filmes</span>
                </button>
                <button class="nav-btn" data-category="series">
                    <i class="fas fa-video"></i>
                    <span>Séries</span>
                </button>
                <button class="nav-btn" data-category="favorites">
                    <i class="fas fa-heart"></i>
                    <span>Favoritos</span>
                </button>
            </nav>
            <!-- Conteúdo por Categoria -->
            <div class="content-container">
                <!-- Destaques -->
                <section class="content-section featured-section">
                    <h2 class="section-title">Destaques</h2>
                    <div class="content-grid featured-grid" id="featured-content">
                        <!-- Conteúdo em destaque será inserido aqui -->
                    </div>
                </section>
                <!-- Canais ao Vivo -->
                <section class="content-section live-section">
                    <h2 class="section-title">Canais ao Vivo</h2>
                    <div class="category-filters" id="live-categories">
                        <!-- Categorias de canais serão inseridas aqui -->
                    </div>
                    <div class="content-grid" id="live-content">
                        <!-- Canais serão inseridos aqui -->
                    </div>
                </section>
                <!-- Filmes -->
                <section class="content-section vod-section">
                    <h2 class="section-title">Filmes</h2>
                    <div class="category-filters" id="vod-categories">
                        <!-- Categorias de filmes serão inseridas aqui -->
                    </div>
                    <div class="content-grid" id="vod-content">
                        <!-- Filmes serão inseridos aqui -->
                    </div>
                </section>
                <!-- Séries -->
                <section class="content-section series-section">
                    <h2 class="section-title">Séries</h2>
                    <div class="category-filters" id="series-categories">
                        <!-- Categorias de séries serão inseridas aqui -->
                    </div>
                    <div class="content-grid" id="series-content">
                        <!-- Séries serão inseridos aqui -->
                    </div>
                </section>
                <!-- Favoritos -->
                <section class="content-section favorites-section">
                    <h2 class="section-title">Favoritos</h2>
                    <div class="content-grid" id="favorites-content">
                        <!-- Conteúdo favorito será inserido aqui -->
                    </div>
                </section>
            </div>
        </main>
        <!-- Rodapé -->
        <footer class="main-footer">
            <p>Feito por Dark Mensageiro</p>
        </footer>
    </div>
    <!-- Tela do Player -->
    <div id="player-screen" class="screen">
        <div class="player-container">
            <div class="player-header">
                <button id="back-btn" class="icon-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 id="player-title">Título do Conteúdo</h2>
                <div>
                    <button id="quality-btn" class="icon-btn" title="Qualidade">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="favorite-btn" class="icon-btn">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
            </div>
            <div class="player-content">
                <div id="player-container"></div>
            </div>
            <div class="player-info" id="player-info">
                <div class="info-container">
                    <h3>Informações do Conteúdo</h3>
                    <div id="content-details">
                        <!-- Detalhes do conteúdo serão inseridos aqui -->
                    </div>
                    <div class="player-controls">
                        <!-- Controles adicionais serão inseridos aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de Informações -->
    <div id="info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Informações</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>Dark ClaroTV Mod</strong></p>
                <p>Versão: 1.0.0</p>
                <p>Desenvolvido por: Dark Mensageiro</p>
                <p>Este aplicativo permite assistir a conteúdo de streaming através de servidores Xtream Codes.</p>
                <p>Integração com a API do TMDB para informações detalhadas de filmes e séries.</p>
            </div>
        </div>
    </div>
    <!-- Modal de Episódios da Série -->
    <div id="series-episodes-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="series-modal-title">Título da Série</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="series-seasons-container">
                    <!-- As temporadas e episódios serão inseridos aqui -->
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de Seleção de Qualidade -->
    <div id="quality-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Selecionar Qualidade</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="quality-options">
                    <button class="quality-btn" data-quality="auto">Automático</button>
                    <button class="quality-btn" data-quality="low">Baixa</button>
                    <button class="quality-btn" data-quality="medium">Média</button>
                    <button class="quality-btn" data-quality="high">Alta</button>
                    <button class="quality-btn" data-quality="hd">HD</button>
                    <button class="quality-btn" data-quality="fullhd">Full HD</button>
                    <button class="quality-btn" data-quality="4k">4K</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        // ==================== CONFIGURAÇÕES GLOBAIS ====================
        const APP_NAME = 'Dark ClaroTV Mod';
        const APP_VERSION = '1.0.0';
        const CREATOR = 'Dark Mensageiro';
        
        // Configuração da API Xtream
        const xtreamConfig = {
            baseUrl: '',
            user: '',
            pass: ''
        };
        
        // Configuração da API TMDB
        const tmdbConfig = {
            apiKey: '',
            baseUrl: 'https://api.themoviedb.org/3',
            imageUrl: 'https://image.tmdb.org/t/p/w500'
        };
        
        // Cache para armazenar dados
        const cache = {
            live: [],       // Canais ao vivo
            vod: {},        // Filmes (organizados por categoria)
            series: {},     // Séries (organizadas por categoria)
            live_cat: [],   // Categorias de canais
            vod_cat: [],    // Categorias de filmes
            series_cat: [],  // Categorias de séries
            epg: {},        // EPG (Guia de Programação)
            tmdb: {}        // Cache para dados do TMDB
        };
        
        // Estado da aplicação
        let activeCat = 'live';
        let showAdult = false;
        let currentProfile = {
            name: '',
            server: '',
            username: '',
            password: '',
            tmdbApiKey: '',
            progress: {}
        };
        
        // Player
        let playerInstance = null;
        let hlsInstance = null;
        let currentContent = null;
        let currentContentType = '';
        
        // ==================== INICIALIZAÇÃO ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar se há um perfil salvo
            loadProfileData();
            
            // Configurar event listeners
            setupEventListeners();
            
            // Se já tiver um perfil salvo, ir para a tela principal
            if (currentProfile.server && currentProfile.username && currentProfile.password) {
                showScreen('main-screen');
                xtreamConfig.baseUrl = currentProfile.server;
                xtreamConfig.user = currentProfile.username;
                xtreamConfig.pass = currentProfile.password;
                tmdbConfig.apiKey = currentProfile.tmdbApiKey || '';
                fetchInitialData();
            }
        });
        
        // ==================== GERENCIAMENTO DE TELAS ====================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            // Login form
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            
            // Navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const category = btn.getAttribute('data-category');
                    setActiveCategory(category);
                });
            });
            
            // Search functionality
            document.getElementById('search-btn').addEventListener('click', performSearch);
            document.getElementById('search-input').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // Header buttons
            document.getElementById('info-btn').addEventListener('click', showInfoModal);
            document.getElementById('add-account-btn').addEventListener('click', () => {
                currentProfile = { name: '', server: '', username: '', password: '', tmdbApiKey: '', progress: {} };
                saveProfileData();
                showScreen('login-screen');
            });
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            
            // Player screen buttons
            document.getElementById('back-btn').addEventListener('click', () => {
                showScreen('main-screen');
                destroyPlayer();
            });
            document.getElementById('favorite-btn').addEventListener('click', toggleFavorite);
            document.getElementById('quality-btn').addEventListener('click', showQualityModal);
            
            // Modal close buttons
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.closest('.modal').classList.remove('active');
                });
            });
            
            // Click outside modal to close
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        }
        
        // ==================== LOGIN ====================
        function handleLogin(e) {
            e.preventDefault();
            
            const serverUrl = document.getElementById('server-url').value.trim();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const tmdbApiKey = document.getElementById('tmdb-api-key').value.trim();
            
            if (!serverUrl || !username || !password) {
                showError('Por favor, preencha os campos obrigatórios.');
                return;
            }
            
            // Salvar perfil
            currentProfile.server = serverUrl;
            currentProfile.username = username;
            currentProfile.password = password;
            currentProfile.tmdbApiKey = tmdbApiKey;
            saveProfileData();
            
            // Configurar APIs
            xtreamConfig.baseUrl = serverUrl;
            xtreamConfig.user = username;
            xtreamConfig.pass = password;
            tmdbConfig.apiKey = tmdbApiKey;
            
            // Carregar dados iniciais
            fetchInitialData().then(() => {
                showScreen('main-screen');
            }).catch(error => {
                console.error('Erro ao carregar dados:', error);
                showError('Falha ao conectar. Verifique suas credenciais.');
            });
        }
        
        // ==================== LÓGICA DE CAPTURA DE INFORMAÇÕES ====================
        // Função principal para carregar dados iniciais
        async function fetchInitialData() {
            const { baseUrl, user, pass } = xtreamConfig;
            const baseApi = `${baseUrl}/player_api.php?username=${user}&password=${pass}`;
            
            try {
                // Requisições paralelas para obter dados básicos
                const [live, live_cat, vod_cat, series_cat] = await Promise.all([
                    fetchAPI(`${baseApi}&action=get_live_streams`),
                    fetchAPI(`${baseApi}&action=get_live_categories`),
                    fetchAPI(`${baseApi}&action=get_vod_categories`),
                    fetchAPI(`${baseApi}&action=get_series_categories`),
                ]);
                
                // Processamento e filtragem de conteúdo adulto
                cache.live_cat = filterAdult(Array.isArray(live_cat) ? live_cat : []);
                cache.live = filterAdult(Array.isArray(live) ? live : [], cache.live_cat);
                
                cache.vod_cat = filterAdult(Array.isArray(vod_cat) ? vod_cat : []);
                cache.series_cat = filterAdult(Array.isArray(series_cat) ? series_cat : []);
                
                // Renderizar conteúdo inicial
                renderContent(activeCat || 'live');
                
                // Carregar filmes e séries em segundo plano
                loadVodAndSeries();
                
                // Carregar EPG em segundo plano
                loadEPG();
                
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
                throw error;
            }
        }
        
        // Função para carregar filmes e séries em segundo plano
        async function loadVodAndSeries() {
            const { baseUrl, user, pass } = xtreamConfig;
            const baseApi = `${baseUrl}/player_api.php?username=${user}&password=${pass}`;
            
            try {
                // Requisições paralelas para obter filmes e séries
                const [vod, series] = await Promise.all([
                    fetchAPI(`${baseApi}&action=get_vod_streams`),
                    fetchAPI(`${baseApi}&action=get_series`),
                ]);
                
                // Processamento e filtragem de conteúdo adulto
                const filteredVod = filterAdult(Array.isArray(vod) ? vod : [], cache.vod_cat);
                const filteredSeries = filterAdult(Array.isArray(series) ? series : [], cache.series_cat);
                
                // Organizar por categoria
                cache.vod = organizeByCategory(filteredVod, 'category_id');
                cache.series = organizeByCategory(filteredSeries, 'category_id');
                
                // Renderizar conteúdo se necessário
                if (activeCat === 'vod' || activeCat === 'series') {
                    renderContent(activeCat);
                }
                
            } catch (error) {
                console.error("Erro ao carregar filmes e séries:", error);
            }
        }
        
        // Função para carregar EPG em segundo plano
        async function loadEPG() {
            const { baseUrl, user, pass } = xtreamConfig;
            const baseApi = `${baseUrl}/player_api.php?username=${user}&password=${pass}`;
            
            try {
                // Obter EPG para todos os canais
                const epgData = await fetchAPI(`${baseApi}&action=get_epg_categories`);
                
                if (Array.isArray(epgData)) {
                    // Para cada categoria de EPG, obter os programas
                    for (const category of epgData) {
                        try {
                            const categoryEPG = await fetchAPI(`${baseApi}&action=get_epg&category_id=${category.category_id}`);
                            cache.epg[category.category_id] = categoryEPG;
                        } catch (error) {
                            console.error(`Erro ao carregar EPG para categoria ${category.category_id}:`, error);
                        }
                    }
                }
            } catch (error) {
                console.error("Erro ao carregar EPG:", error);
            }
        }
        
        // Função para buscar dados da API
        async function fetchAPI(url) {
            // Usando o proxy CORS do AllOrigins que é mais adequado para streams
            const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
            const REQUEST_TIMEOUT = 20000;
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);
            
            try {
                const response = await fetch(CORS_PROXY + encodeURIComponent(url), { 
                    signal: controller.signal, 
                    cache: 'no-store' 
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`API fetch failed (status ${response.status})`);
                }
                
                const data = await response.json();
                return (data === null || (typeof data === 'object' && !Array.isArray(data) && Object.keys(data).length === 0)) 
                    ? [] 
                    : data;
            } catch (e) {
                throw e;
            }
        }
        
        // Função para carregar streams de vídeo
        async function loadVideoStream(url) {
            try {
                // Tentar carregar diretamente primeiro
                const response = await fetch(url, {
                    method: 'HEAD',
                    mode: 'cors',
                    cache: 'no-store'
                });
                
                if (response.ok) {
                    return url;
                }
            } catch (e) {
                console.error('Erro ao carregar stream diretamente:', e);
            }
            
            // Se falhar, tentar com proxy CORS
            const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
            return CORS_PROXY + encodeURIComponent(url);
        }
        
        // Função para filtrar conteúdo adulto
        function filterAdult(items, cats = []) {
            if (showAdult || !items || items.length === 0) return items;
            
            const catMap = new Map(cats.map(c => [c.category_id, c.category_name]));
            const adultKeywords = atob('YWR1bHRvLGFkdWx0cyxzZXgseHh4LGhhcmRjb3JlLHByaXZhZG8scHJpdmFkZSx2aXAscGxheWJveSxwcml2ZSxob3QsZXJvdGljLHJlZGxpZ2h0LG9ubHlmYW5zLHJlZHR1YmUseHZpZGVvcyxwb3JuLHNleG8sZXJvdGljbyxwcml2YXRlLGJyYXNpbGVpcmluaGFzLHRlc3RlIGRlIGZpZGVsaWRhZGU')
                .split(',')
                .map(k => k.toLowerCase());
            
            return items.filter(item => {
                const itemName = (item.name || item.category_name || '').toLowerCase();
                const catName = (catMap.get(item.category_id) || '').toLowerCase();
                return !adultKeywords.some(kw => itemName.includes(kw) || catName.includes(kw));
            });
        }
        
        // Função para organizar itens por categoria
        function organizeByCategory(items, categoryKey) {
            const result = {};
            
            if (!items || items.length === 0) return result;
            
            items.forEach(item => {
                const categoryId = item[categoryKey] || 'uncategorized';
                if (!result[categoryId]) {
                    result[categoryId] = [];
                }
                result[categoryId].push(item);
            });
            
            return result;
        }
        
        // Função para buscar detalhes de filmes/séries
        async function fetchContentDetails(type, contentId) {
            const { baseUrl, user, pass } = xtreamConfig;
            const baseApi = `${baseUrl}/player_api.php?username=${user}&password=${pass}`;
            
            const action = type === 'vod' 
                ? `get_vod_info&vod_id=${contentId}` 
                : `get_series_info&series_id=${contentId}`;
            
            try {
                const data = await fetchAPI(`${baseApi}&action=${action}`);
                
                // Para VOD, os dados estão dentro de movie_data
                if (type === 'vod' && data && data.movie_data) {
                    return data.movie_data;
                }
                
                // Para séries, retornar os dados diretamente
                return data || {};
            } catch (error) {
                console.error('Erro ao buscar detalhes do conteúdo:', error);
                return {};
            }
        }
        
        // Função para buscar EPG atual de um canal
        async function fetchCurrentEPG(streamId) {
            const { baseUrl, user, pass } = xtreamConfig;
            const baseApi = `${baseUrl}/player_api.php?username=${user}&password=${pass}`;
            
            try {
                // Obter a lista de EPGs para o canal
                const epgList = await fetchAPI(`${baseApi}&action=get_short_epg&stream_id=${streamId}&limit=5`);
                
                if (!epgList || epgList.length === 0) {
                    return {};
                }
                
                // O EPG atual é o primeiro da lista (que ainda não terminou)
                const now = Math.floor(Date.now() / 1000);
                const currentEPG = epgList.find(epg => epg.end > now);
                
                return {
                    current: currentEPG || null
                };
            } catch (error) {
                console.error('Erro ao buscar EPG:', error);
                return {};
            }
        }
        
        // Função para buscar dados do TMDB
        async function fetchTMDBData(type, id, seasonNumber = null, episodeNumber = null) {
            if (!tmdbConfig.apiKey) {
                return null;
            }
            
            // Verificar cache primeiro
            const cacheKey = `${type}_${id}${seasonNumber !== null ? `_${seasonNumber}` : ''}${episodeNumber !== null ? `_${episodeNumber}` : ''}`;
            if (cache.tmdb[cacheKey]) {
                return cache.tmdb[cacheKey];
            }
            
            let url = `${tmdbConfig.baseUrl}/${type}/${id}?api_key=${tmdbConfig.apiKey}&language=pt-BR`;
            
            if (type === 'tv' && seasonNumber !== null) {
                if (episodeNumber !== null) {
                    url = `${tmdbConfig.baseUrl}/${type}/${id}/season/${seasonNumber}/episode/${episodeNumber}?api_key=${tmdbConfig.apiKey}&language=pt-BR`;
                } else {
                    url = `${tmdbConfig.baseUrl}/${type}/${id}/season/${seasonNumber}?api_key=${tmdbConfig.apiKey}&language=pt-BR`;
                }
            }
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    return null;
                }
                
                const data = await response.json();
                
                // Salvar no cache
                cache.tmdb[cacheKey] = data;
                
                return data;
            } catch (error) {
                console.error('Erro ao buscar dados do TMDB:', error);
                return null;
            }
        }
        
        // Função para buscar por título no TMDB
        async function searchTMDB(query, type = 'multi') {
            if (!tmdbConfig.apiKey || !query) {
                return null;
            }
            
            const url = `${tmdbConfig.baseUrl}/search/${type}?api_key=${tmdbConfig.apiKey}&language=pt-BR&query=${encodeURIComponent(query)}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    return null;
                }
                
                const data = await response.json();
                return data.results || [];
            } catch (error) {
                console.error('Erro ao buscar no TMDB:', error);
                return null;
            }
        }
        
        // ==================== RENDERIZAÇÃO DE CONTEÚDO ====================
        function setActiveCategory(category) {
            activeCat = category;
            
            // Atualizar botões de navegação
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === category) {
                    btn.classList.add('active');
                }
            });
            
            // Renderizar conteúdo da categoria
            renderContent(category);
        }
        
        function renderContent(category) {
            // Esconder todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Mostrar seção correspondente
            switch (category) {
                case 'live':
                    renderLiveContent();
                    document.querySelector('.live-section').classList.remove('hidden');
                    break;
                case 'vod':
                    renderVodContent();
                    document.querySelector('.vod-section').classList.remove('hidden');
                    break;
                case 'series':
                    renderSeriesContent();
                    document.querySelector('.series-section').classList.remove('hidden');
                    break;
                case 'favorites':
                    renderFavoritesContent();
                    document.querySelector('.favorites-section').classList.remove('hidden');
                    break;
            }
        }
        
        function renderLiveContent() {
            // Renderizar categorias
            const categoriesContainer = document.getElementById('live-categories');
            categoriesContainer.innerHTML = '';
            
            const allBtn = document.createElement('button');
            allBtn.className = 'category-btn active';
            allBtn.textContent = 'Todos';
            allBtn.addEventListener('click', () => {
                document.querySelectorAll('#live-categories .category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                allBtn.classList.add('active');
                renderLiveItems();
            });
            categoriesContainer.appendChild(allBtn);
            
            cache.live_cat.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.textContent = cat.category_name;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#live-categories .category-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    renderLiveItems(cat.category_id);
                });
                categoriesContainer.appendChild(btn);
            });
            
            // Renderizar canais
            renderLiveItems();
            
            // Renderizar destaques (primeiros 6 canais)
            renderFeaturedContent(cache.live.slice(0, 6));
        }
        
        function renderLiveItems(categoryId = null) {
            const container = document.getElementById('live-content');
            container.innerHTML = '';
            
            let items = cache.live;
            if (categoryId) {
                items = items.filter(item => item.category_id == categoryId);
            }
            
            if (items.length === 0) {
                container.innerHTML = '<p class="error-message">Nenhum canal encontrado.</p>';
                return;
            }
            
            // Renderizar apenas os primeiros 20 itens para melhor performance
            const itemsToRender = items.slice(0, 20);
            itemsToRender.forEach(item => {
                const card = createContentCard(item, 'live');
                container.appendChild(card);
            });
            
            // Adicionar botão "Carregar mais" se houver mais itens
            if (items.length > 20) {
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.className = 'btn-primary';
                loadMoreBtn.textContent = 'Carregar mais';
                loadMoreBtn.style.marginTop = '1rem';
                loadMoreBtn.addEventListener('click', () => {
                    const currentCount = container.querySelectorAll('.content-card').length;
                    const nextItems = items.slice(currentCount, currentCount + 20);
                    nextItems.forEach(item => {
                        const card = createContentCard(item, 'live');
                        container.appendChild(card);
                    });
                    
                    // Se não houver mais itens, remover o botão
                    if (currentCount + nextItems.length >= items.length) {
                        loadMoreBtn.remove();
                    }
                });
                container.appendChild(loadMoreBtn);
            }
        }
        
        function renderVodContent() {
            // Renderizar categorias
            const categoriesContainer = document.getElementById('vod-categories');
            categoriesContainer.innerHTML = '';
            
            const allBtn = document.createElement('button');
            allBtn.className = 'category-btn active';
            allBtn.textContent = 'Todos';
            allBtn.addEventListener('click', () => {
                document.querySelectorAll('#vod-categories .category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                allBtn.classList.add('active');
                renderVodItems();
            });
            categoriesContainer.appendChild(allBtn);
            
            cache.vod_cat.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.textContent = cat.category_name;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#vod-categories .category-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    renderVodItems(cat.category_id);
                });
                categoriesContainer.appendChild(btn);
            });
            
            // Renderizar filmes
            renderVodItems();
        }
        
        function renderVodItems(categoryId = null) {
            const container = document.getElementById('vod-content');
            container.innerHTML = '';
            
            let items = [];
            if (categoryId) {
                items = cache.vod[categoryId] || [];
            } else {
                // Combinar todos os filmes de todas as categorias
                Object.values(cache.vod).forEach(categoryItems => {
                    items = items.concat(categoryItems);
                });
            }
            
            if (items.length === 0) {
                container.innerHTML = '<p class="error-message">Nenhum filme encontrado.</p>';
                return;
            }
            
            // Renderizar apenas os primeiros 20 itens para melhor performance
            const itemsToRender = items.slice(0, 20);
            itemsToRender.forEach(item => {
                const card = createContentCard(item, 'vod');
                container.appendChild(card);
            });
            
            // Adicionar botão "Carregar mais" se houver mais itens
            if (items.length > 20) {
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.className = 'btn-primary';
                loadMoreBtn.textContent = 'Carregar mais';
                loadMoreBtn.style.marginTop = '1rem';
                loadMoreBtn.addEventListener('click', () => {
                    const currentCount = container.querySelectorAll('.content-card').length;
                    const nextItems = items.slice(currentCount, currentCount + 20);
                    nextItems.forEach(item => {
                        const card = createContentCard(item, 'vod');
                        container.appendChild(card);
                    });
                    
                    // Se não houver mais itens, remover o botão
                    if (currentCount + nextItems.length >= items.length) {
                        loadMoreBtn.remove();
                    }
                });
                container.appendChild(loadMoreBtn);
            }
        }
        
        function renderSeriesContent() {
            // Renderizar categorias
            const categoriesContainer = document.getElementById('series-categories');
            categoriesContainer.innerHTML = '';
            
            const allBtn = document.createElement('button');
            allBtn.className = 'category-btn active';
            allBtn.textContent = 'Todos';
            allBtn.addEventListener('click', () => {
                document.querySelectorAll('#series-categories .category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                allBtn.classList.add('active');
                renderSeriesItems();
            });
            categoriesContainer.appendChild(allBtn);
            
            cache.series_cat.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.textContent = cat.category_name;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#series-categories .category-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    renderSeriesItems(cat.category_id);
                });
                categoriesContainer.appendChild(btn);
            });
            
            // Renderar séries
            renderSeriesItems();
        }
        
        function renderSeriesItems(categoryId = null) {
            const container = document.getElementById('series-content');
            container.innerHTML = '';
            
            let items = [];
            if (categoryId) {
                items = cache.series[categoryId] || [];
            } else {
                // Combinar todas as séries de todas as categorias
                Object.values(cache.series).forEach(categoryItems => {
                    items = items.concat(categoryItems);
                });
            }
            
            if (items.length === 0) {
                container.innerHTML = '<p class="error-message">Nenhuma série encontrada.</p>';
                return;
            }
            
            // Renderizar apenas os primeiros 20 itens para melhor performance
            const itemsToRender = items.slice(0, 20);
            itemsToRender.forEach(item => {
                const card = createContentCard(item, 'series');
                container.appendChild(card);
            });
            
            // Adicionar botão "Carregar mais" se houver mais itens
            if (items.length > 20) {
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.className = 'btn-primary';
                loadMoreBtn.textContent = 'Carregar mais';
                loadMoreBtn.style.marginTop = '1rem';
                loadMoreBtn.addEventListener('click', () => {
                    const currentCount = container.querySelectorAll('.content-card').length;
                    const nextItems = items.slice(currentCount, currentCount + 20);
                    nextItems.forEach(item => {
                        const card = createContentCard(item, 'series');
                        container.appendChild(card);
                    });
                    
                    // Se não houver mais itens, remover o botão
                    if (currentCount + nextItems.length >= items.length) {
                        loadMoreBtn.remove();
                    }
                });
                container.appendChild(loadMoreBtn);
            }
        }
        
        function renderFeaturedContent(items) {
            const container = document.getElementById('featured-content');
            container.innerHTML = '';
            
            if (items.length === 0) {
                container.innerHTML = '<p class="error-message">Nenhum destaque encontrado.</p>';
                return;
            }
            
            items.forEach(item => {
                const card = createContentCard(item, item.type || 'live');
                container.appendChild(card);
            });
        }
        
        function renderFavoritesContent() {
            const container = document.getElementById('favorites-content');
            container.innerHTML = '';
            
            const favorites = getFavorites();
            if (favorites.length === 0) {
                container.innerHTML = '<p class="error-message">Nenhum favorito encontrado.</p>';
                return;
            }
            
            favorites.forEach(item => {
                const card = createContentCard(item, item.type);
                container.appendChild(card);
            });
        }
        
        function createContentCard(item, type) {
            const card = document.createElement('div');
            card.className = 'content-card';
            
            // Imagem
            const img = document.createElement('img');
            img.src = item.stream_icon || item.cover || item.backdrop_path?.[0] || 'https://via.placeholder.com/300x169?text=Sem+Imagem';
            img.alt = item.name;
            img.className = 'lazy-load';
            img.onload = () => img.classList.add('loaded');
            img.onerror = () => {
                img.src = 'https://via.placeholder.com/300x169?text=Sem+Imagem';
                img.classList.add('loaded');
            };
            card.appendChild(img);
            
            // Informações
            const info = document.createElement('div');
            info.className = 'content-info';
            
            const title = document.createElement('div');
            title.className = 'content-title';
            title.textContent = item.name;
            info.appendChild(title);
            
            const meta = document.createElement('div');
            meta.className = 'content-meta';
            
            if (type === 'live') {
                meta.textContent = 'Canal ao Vivo';
            } else if (type === 'vod') {
                const rating = item.rating ? `${item.rating} ★` : '';
                const year = item.releasedate ? new Date(item.releasedate).getFullYear() : '';
                meta.textContent = [rating, year].filter(Boolean).join(' • ');
            } else if (type === 'series') {
                const year = item.releasedate ? new Date(item.releasedate).getFullYear() : '';
                const seasons = item.seasons ? `${item.seasons.length} temporadas` : '';
                meta.textContent = [year, seasons].filter(Boolean).join(' • ');
            }
            
            info.appendChild(meta);
            card.appendChild(info);
            
            // Botão de favorito
            const favoriteBtn = document.createElement('button');
            favoriteBtn.className = 'favorite-icon';
            favoriteBtn.innerHTML = '<i class="fas fa-heart"></i>';
            
            const favorites = getFavorites();
            const isFavorite = favorites.some(fav => fav.id === item.stream_id || fav.id === item.id);
            if (isFavorite) {
                favoriteBtn.classList.add('active');
            }
            
            favoriteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavoriteItem(item, type, favoriteBtn);
            });
            
            card.appendChild(favoriteBtn);
            
            // Evento de clique
            card.addEventListener('click', () => {
                if (type === 'series') {
                    // Para séries, exibir o modal de temporadas e episódios
                    showSeriesEpisodes(item.series_id || item.stream_id || item.id, item.name);
                } else {
                    // Para outros tipos, reproduzir diretamente
                    playMedia(item, type);
                }
            });
            
            return card;
        }
        
        // ==================== LÓGICA DE SÉRIES E EPISÓDIOS ====================
        async function showSeriesEpisodes(seriesId, seriesName) {
            // Atualizar título do modal
            document.getElementById('series-modal-title').textContent = seriesName;
            
            // Exibir modal
            document.getElementById('series-episodes-modal').classList.add('active');
            
            // Mostrar loading
            const container = document.getElementById('series-seasons-container');
            container.innerHTML = '<div class="loading-spinner"></div>';
            
            try {
                // Buscar detalhes da série
                const { baseUrl, user, pass } = xtreamConfig;
                const baseApi = `${baseUrl}/player_api.php?username=${user}&password=${pass}`;
                const seriesDetails = await fetchAPI(`${baseApi}&action=get_series_info&series_id=${seriesId}`);
                
                // Se não tiver detalhes da série, tentar buscar no TMDB
                let tmdbSeriesData = null;
                if (tmdbConfig.apiKey && seriesDetails && seriesDetails.info && seriesDetails.info.name) {
                    const searchResults = await searchTMDB(seriesDetails.info.name, 'tv');
                    if (searchResults && searchResults.length > 0) {
                        tmdbSeriesData = await fetchTMDBData('tv', searchResults[0].id);
                    }
                }
                
                // Limpar container
                container.innerHTML = '';
                
                // Verificar se temos episódios
                if (!seriesDetails || !seriesDetails.episodes || Object.keys(seriesDetails.episodes).length === 0) {
                    container.innerHTML = '<p class="error-message">Nenhuma temporada encontrada.</p>';
                    return;
                }
                
                // Obter as temporadas (chaves do objeto episodes)
                const seasonIds = Object.keys(seriesDetails.episodes).sort((a, b) => parseInt(a) - parseInt(b));
                
                // Criar seção para cada temporada
                for (const seasonId of seasonIds) {
                    const seasonSection = document.createElement('div');
                    seasonSection.className = 'season-section';
                    
                    // Obter dados da temporada do TMDB se disponível
                    let tmdbSeasonData = null;
                    if (tmdbSeriesData) {
                        tmdbSeasonData = await fetchTMDBData('tv', tmdbSeriesData.id, parseInt(seasonId));
                    }
                    
                    const seasonHeader = document.createElement('div');
                    seasonHeader.className = 'season-header';
                    
                    // Nome da temporada com dados do TMDB se disponível
                    let seasonName = `Temporada ${seasonId}`;
                    if (tmdbSeasonData && tmdbSeasonData.name) {
                        seasonName = tmdbSeasonData.name;
                    }
                    
                    seasonHeader.innerHTML = `
                        <h3>${seasonName}</h3>
                        <button class="toggle-season-btn">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    `;
                    
                    const episodesContainer = document.createElement('div');
                    episodesContainer.className = 'episodes-container';
                    episodesContainer.style.display = 'none';
                    
                    // Adicionar episódios
                    const episodes = seriesDetails.episodes[seasonId];
                    if (episodes && episodes.length > 0) {
                        // Ordenar episódios pelo número
                        const sortedEpisodes = episodes.sort((a, b) => parseInt(a.episode_num) - parseInt(b.episode_num));
                        
                        for (const episode of sortedEpisodes) {
                            // Obter dados do episódio do TMDB se disponível
                            let tmdbEpisodeData = null;
                            if (tmdbSeasonData) {
                                tmdbEpisodeData = tmdbSeasonData.episodes && 
                                    tmdbSeasonData.episodes.find(e => e.episode_number === parseInt(episode.episode_num));
                            }
                            
                            const episodeCard = document.createElement('div');
                            episodeCard.className = 'episode-card';
                            
                            // Título do episódio com dados do TMDB se disponível
                            let episodeTitle = `Episódio ${episode.episode_num || episode.id}`;
                            if (tmdbEpisodeData && tmdbEpisodeData.name) {
                                episodeTitle = tmdbEpisodeData.name;
                            } else if (episode.title) {
                                episodeTitle = episode.title;
                            }
                            
                            // Sinopse do episódio com dados do TMDB se disponível
                            let episodePlot = 'Sinopse não disponível.';
                            if (tmdbEpisodeData && tmdbEpisodeData.overview) {
                                episodePlot = tmdbEpisodeData.overview;
                            } else if (episode.plot) {
                                episodePlot = episode.plot;
                            } else if (episode.overview) {
                                episodePlot = episode.overview;
                            }
                            
                            // Imagem do episódio com dados do TMDB se disponível
                            let episodeImage = '';
                            if (tmdbEpisodeData && tmdbEpisodeData.still_path) {
                                episodeImage = `<img src="${tmdbConfig.imageUrl}${tmdbEpisodeData.still_path}" alt="${episodeTitle}" style="width: 100%; border-radius: 4px; margin-bottom: 0.5rem;">`;
                            }
                            
                            episodeCard.innerHTML = `
                                <div class="episode-info">
                                    ${episodeImage}
                                    <h4>Episódio ${episode.episode_num || episode.id}: ${episodeTitle}</h4>
                                    <p>${episodePlot}</p>
                                </div>
                                <button class="play-episode-btn" data-series-id="${seriesId}" data-season-id="${seasonId}" data-episode-id="${episode.id}">
                                    <i class="fas fa-play"></i>
                                </button>
                            `;
                            
                            episodesContainer.appendChild(episodeCard);
                        }
                    } else {
                        episodesContainer.innerHTML = '<p class="error-message">Nenhum episódio encontrado nesta temporada.</p>';
                    }
                    
                    // Adicionar evento para expandir/recolher temporada
                    seasonHeader.querySelector('.toggle-season-btn').addEventListener('click', () => {
                        const isVisible = episodesContainer.style.display !== 'none';
                        episodesContainer.style.display = isVisible ? 'none' : 'block';
                        seasonHeader.querySelector('.toggle-season-btn i').className = isVisible ? 'fas fa-chevron-down' : 'fas fa-chevron-up';
                    });
                    
                    seasonSection.appendChild(seasonHeader);
                    seasonSection.appendChild(episodesContainer);
                    container.appendChild(seasonSection);
                }
                
                // Adicionar evento aos botões de reprodução de episódio
                container.querySelectorAll('.play-episode-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const seriesId = btn.getAttribute('data-series-id');
                        const seasonId = btn.getAttribute('data-season-id');
                        const episodeId = btn.getAttribute('data-episode-id');
                        
                        // Fechar modal
                        document.getElementById('series-episodes-modal').classList.remove('active');
                        
                        // Reproduzir episódio
                        playEpisode(seriesId, seasonId, episodeId);
                    });
                });
                
            } catch (error) {
                console.error('Erro ao carregar episódios:', error);
                container.innerHTML = '<p class="error-message">Erro ao carregar episódios.</p>';
            }
        }
        
        async function playEpisode(seriesId, seasonId, episodeId) {
            try {
                // Buscar detalhes da série
                const { baseUrl, user, pass } = xtreamConfig;
                const baseApi = `${baseUrl}/player_api.php?username=${user}&password=${pass}`;
                const seriesDetails = await fetchAPI(`${baseApi}&action=get_series_info&series_id=${seriesId}`);
                
                if (!seriesDetails || !seriesDetails.episodes || !seriesDetails.episodes[seasonId]) {
                    showError('Temporada não encontrada.');
                    return;
                }
                
                const episode = seriesDetails.episodes[seasonId].find(ep => ep.id == episodeId);
                if (!episode) {
                    showError('Episódio não encontrado.');
                    return;
                }
                
                // Tentar buscar dados do TMDB para este episódio
                let tmdbEpisodeData = null;
                if (tmdbConfig.apiKey && seriesDetails.info && seriesDetails.info.name) {
                    const searchResults = await searchTMDB(seriesDetails.info.name, 'tv');
                    if (searchResults && searchResults.length > 0) {
                        const tmdbSeriesData = await fetchTMDBData('tv', searchResults[0].id);
                        if (tmdbSeriesData) {
                            const tmdbSeasonData = await fetchTMDBData('tv', tmdbSeriesData.id, parseInt(seasonId));
                            if (tmdbSeasonData && tmdbSeasonData.episodes) {
                                tmdbEpisodeData = tmdbSeasonData.episodes.find(e => e.episode_number === parseInt(episode.episode_num));
                            }
                        }
                    }
                }
                
                // Preparar informações do episódio
                const episodeInfo = {
                    ...episode,
                    series_id: seriesId,
                    season_id: seasonId,
                    name: `${seriesDetails.info?.name || 'Série'} - S${seasonId}:E${episode.episode_num} - ${episode.title || `Episódio ${episode.episode_num}`}`,
                    tmdbEpisodeData: tmdbEpisodeData
                };
                
                // Reproduzir mídia
                playMedia(episodeInfo, 'series');
                
            } catch (error) {
                console.error('Erro ao reproduzir episódio:', error);
                showError('Erro ao reproduzir episódio.');
            }
        }
        
        // ==================== LÓGICA DE REPRODUÇÃO DE CONTEÚDO ====================
        function playMedia(item, type, quality = null) {
            currentContent = item;
            currentContentType = type;
            
            // Atualizar título do player
            document.getElementById('player-title').textContent = item.name;
            
            // Atualizar botão de favorito
            const favoriteBtn = document.getElementById('favorite-btn');
            const favorites = getFavorites();
            const isFavorite = favorites.some(fav => fav.id === item.stream_id || fav.id === item.id);
            favoriteBtn.innerHTML = isFavorite ? '<i class="fas fa-heart"></i>' : '<i class="far fa-heart"></i>';
            
            // Mostrar tela do player
            showScreen('player-screen');
            
            // Configurar player
            setupPlayer(item, type, quality);
            
            // Carregar detalhes do conteúdo
            loadContentDetails(item, type);
        }
        
        function setupPlayer(item, type, quality = null) {
            destroyPlayer(); // Limpar instância anterior
            
            try {
                const playerContainer = document.getElementById('player-container');
                if (!playerContainer) return;
                
                playerContainer.innerHTML = '';
                
                // Criar elemento de vídeo
                const video = document.createElement('video');
                video.id = 'video-player';
                video.playsinline = true;
                video.controls = true;
                video.crossOrigin = "anonymous";
                playerContainer.appendChild(video);
                
                // Preparar URL do stream
                let playbackId;
                let extension;
                
                if (type === 'live') {
                    playbackId = item.stream_id;
                    extension = 'm3u8';
                } else if (type === 'vod') {
                    playbackId = item.stream_id || item.id;
                    extension = item.container_extension || 'mp4';
                } else if (type === 'series') {
                    // Para séries, precisamos do ID do episódio
                    playbackId = item.id;
                    extension = item.container_extension || 'mp4';
                }
                
                const { baseUrl, user, pass } = xtreamConfig;
                let streamUrl = '';
                
                if (type === 'live') {
                    streamUrl = `${baseUrl}/live/${user}/${pass}/${playbackId}.${extension}`;
                } else if (type === 'vod') {
                    streamUrl = `${baseUrl}/movie/${user}/${pass}/${playbackId}.${extension}`;
                } else if (type === 'series') {
                    streamUrl = `${baseUrl}/series/${user}/${pass}/${playbackId}.${extension}`;
                }
                
                // Função para carregar o stream de vídeo
                const loadVideoStream = async (url) => {
                    try {
                        // Tentar carregar diretamente primeiro
                        const response = await fetch(url, {
                            method: 'HEAD',
                            mode: 'cors',
                            cache: 'no-store'
                        });
                        
                        if (response.ok) {
                            return url;
                        }
                    } catch (e) {
                        console.error('Erro ao carregar stream diretamente:', e);
                    }
                    
                    // Se falhar, tentar com proxy CORS
                    const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
                    return CORS_PROXY + encodeURIComponent(url);
                };
                
                // Carregar o stream de vídeo
                loadVideoStream(streamUrl).then(finalUrl => {
                    // Configurar HLS.js para streams M3U8
                    if (Hls.isSupported() && finalUrl.includes('.m3u8')) {
                        hlsInstance = new Hls({
                            capLevelToPlayerSize: true,
                            maxBufferLength: 45,
                            maxMaxBufferLength: 90,
                            enableWorker: true,
                            startLevel: -1,
                            fragLoadingRetryDelay: 1000,
                            fragLoadingMaxRetry: 4,
                            levelLoadingRetryDelay: 1000,
                            levelLoadingMaxRetry: 4,
                            // Adicionar configuração para CORS
                            xhrSetup: function(xhr, url) {
                                xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
                            }
                        });
                        
                        hlsInstance.loadSource(finalUrl);
                        hlsInstance.attachMedia(video);
                        
                        // Ajustar qualidade se especificada
                        if (quality && quality !== 'auto') {
                            // Mapear qualidade para nível
                            const qualityMap = {
                                'low': 0,
                                'medium': 1,
                                'high': 2,
                                'hd': 3,
                                'fullhd': 4,
                                '4k': 5
                            };
                            
                            const level = qualityMap[quality] || -1;
                            if (level >= 0) {
                                hlsInstance.currentLevel = level;
                            }
                        }
                        
                        // Tratamento de erros
                        hlsInstance.on(Hls.Events.ERROR, (event, data) => {
                            if (data.fatal) {
                                switch (data.type) {
                                    case Hls.ErrorTypes.NETWORK_ERROR:
                                    case Hls.ErrorTypes.MEDIA_ERROR:
                                        hlsInstance.destroy();
                                        hlsInstance = null;
                                        video.src = finalUrl;
                                        video.play().catch(() => {
                                            console.error("Falha ao iniciar reprodução");
                                        });
                                        break;
                                    default:
                                        hlsInstance.destroy();
                                        break;
                                }
                            }
                        });
                    } else {
                        // Para vídeos não HLS, tentar carregar diretamente
                        video.src = finalUrl;
                    }
                    
                    // Inicializar Plyr
                    playerInstance = new Plyr(video, {
                        settings: ['quality', 'speed', 'loop', 'pip'],
                        i18n: {
                            "speed": "Velocidade",
                            "settings": "Ajustes",
                            "controls": "Controles",
                            "pip": "Picture-in-Picture"
                        },
                        tooltips: { controls: true }
                    });
                    
                    // Configurar eventos do player
                    playerInstance.on('ready', () => {
                        // Adicionar botões personalizados
                        addCustomControls(playerInstance);
                        
                        // Iniciar reprodução
                        playerInstance.play();
                    });
                    
                    // Definir tempo inicial se especificado
                    if (item.currentTime > 0) {
                        playerInstance.once('canplay', () => {
                            playerInstance.currentTime = item.currentTime;
                        });
                    }
                    
                    // Salvar progresso para conteúdo não ao vivo
                    if (type !== 'live') {
                        const progressInterval = setInterval(() => {
                            savePlaybackProgress(playerInstance, item, playbackId, type);
                        }, 5000);
                        
                        // Limpar intervalo quando o player for destruído
                        playerInstance.on('destroy', () => {
                            clearInterval(progressInterval);
                        });
                    }
                }).catch(error => {
                    console.error("Erro ao carregar stream de vídeo:", error);
                    showError("Erro ao carregar o vídeo. Tente novamente mais tarde.");
                });
                
            } catch (error) {
                console.error("Erro ao configurar player:", error);
                destroyPlayer();
            }
        }
        
        function destroyPlayer() {
            if (playerInstance) {
                try {
                    playerInstance.destroy();
                } catch(e) {}
                playerInstance = null;
            }
            
            if (hlsInstance) {
                hlsInstance.destroy();
                hlsInstance = null;
            }
        }
        
        function savePlaybackProgress(player, item, contentId, type) {
            if (!player || !item || !contentId || player.currentTime < 60) return;
            
            const duration = player.duration;
            const currentTime = player.currentTime;
            
            if (isNaN(duration) || duration <= 0) return;
            
            const isEnding = (duration > 0 && (duration - currentTime < 90));
            const progressKey = String(contentId);
            
            if (isEnding) {
                // Remover progresso se estiver no final
                delete currentProfile.progress[progressKey];
            } else {
                // Salvar progresso atual
                currentProfile.progress[progressKey] = {
                    id: contentId,
                    name: item.name,
                    cover: item.cover || item.stream_icon || item.backdrop_path?.[0],
                    type: type,
                    duration: duration,
                    currentTime: currentTime,
                    lastWatched: Date.now(),
                    series_id: item.series_id,
                    vod_id: item.vod_id,
                    stream_id: item.stream_id,
                };
            }
            
            // Salvar no localStorage
            saveProfileData();
        }
        
        async function loadContentDetails(item, type) {
            const detailsContainer = document.getElementById('content-details');
            detailsContainer.innerHTML = '<div class="loading-spinner"></div>';
            
            try {
                let details = {};
                let tmdbData = null;
                
                if (type === 'vod') {
                    // Buscar detalhes do filme
                    details = await fetchContentDetails(type, item.stream_id || item.id);
                    
                    // Tentar buscar dados do TMDB
                    if (tmdbConfig.apiKey && details.name) {
                        const searchResults = await searchTMDB(details.name, 'movie');
                        if (searchResults && searchResults.length > 0) {
                            tmdbData = await fetchTMDBData('movie', searchResults[0].id);
                        }
                    }
                } else if (type === 'series') {
                    // Para séries, usar os dados do item diretamente
                    details = item;
                    
                    // Se temos dados do episódio do TMDB, usar eles
                    if (item.tmdbEpisodeData) {
                        tmdbData = item.tmdbEpisodeData;
                    }
                } else if (type === 'live') {
                    // Para canais ao vivo, buscar o EPG atual
                    details = await fetchCurrentEPG(item.stream_id);
                }
                
                // Limpar container
                detailsContainer.innerHTML = '';
                
                // Adicionar detalhes básicos
                addDetailRow(detailsContainer, 'Título', item.name);
                
                if (type === 'vod') {
                    // Usar dados do TMDB se disponíveis
                    if (tmdbData) {
                        addDetailRow(detailsContainer, 'Título Original', tmdbData.original_title || 'N/A');
                        addDetailRow(detailsContainer, 'Lançamento', tmdbData.release_date ? new Date(tmdbData.release_date).toLocaleDateString() : 'N/A');
                        addDetailRow(detailsContainer, 'Duração', tmdbData.runtime ? formatDuration(tmdbData.runtime * 60) : (details.duration ? formatDuration(details.duration) : 'N/A'));
                        
                        // Avaliação do TMDB
                        if (tmdbData.vote_average) {
                            const ratingHtml = `
                                <div class="tmdb-rating">
                                    <i class="fas fa-star"></i>
                                    <span>${tmdbData.vote_average.toFixed(1)}/10</span>
                                    <span>(${tmdbData.vote_count} votos)</span>
                                </div>
                            `;
                            const ratingRow = document.createElement('div');
                            ratingRow.innerHTML = `<dt>Avaliação</dt><dd>${ratingHtml}</dd>`;
                            detailsContainer.appendChild(ratingRow);
                        }
                        
                        // Gêneros do TMDB
                        if (tmdbData.genres && tmdbData.genres.length > 0) {
                            const genresHtml = tmdbData.genres.map(genre => 
                                `<span class="tmdb-genre-tag">${genre.name}</span>`
                            ).join('');
                            
                            const genresRow = document.createElement('div');
                            genresRow.innerHTML = `<dt>Gênero</dt><dd><div class="tmdb-genres">${genresHtml}</div></dd>`;
                            detailsContainer.appendChild(genresRow);
                        }
                        
                        // Sinopse do TMDB
                        addDetailRow(detailsContainer, 'Sinopse', tmdbData.overview || details.plot || 'N/A');
                    } else {
                        // Usar dados da Xtream se não tiver do TMDB
                        addDetailRow(detailsContainer, 'Lançamento', details.releasedate ? new Date(details.releasedate).toLocaleDateString() : 'N/A');
                        addDetailRow(detailsContainer, 'Duração', details.duration ? formatDuration(details.duration) : 'N/A');
                        addDetailRow(detailsContainer, 'Classificação', details.rating ? `${details.rating} ★` : 'N/A');
                        addDetailRow(detailsContainer, 'Gênero', details.genre || 'N/A');
                        addDetailRow(detailsContainer, 'Sinopse', details.plot || 'N/A');
                    }
                } else if (type === 'series') {
                    // Usar dados do TMDB se disponíveis
                    if (tmdbData) {
                        addDetailRow(detailsContainer, 'Título do Episódio', tmdbData.name || 'N/A');
                        addDetailRow(detailsContainer, 'Temporada', `Temporada ${details.season_id}`);
                        addDetailRow(detailsContainer, 'Episódio', `Episódio ${details.episode_num}`);
                        
                        // Data de exibição
                        if (tmdbData.air_date) {
                            addDetailRow(detailsContainer, 'Data de Exibição', new Date(tmdbData.air_date).toLocaleDateString());
                        }
                        
                        // Sinopse do TMDB
                        addDetailRow(detailsContainer, 'Sinopse', tmdbData.overview || details.plot || details.overview || 'N/A');
                    } else {
                        // Usar dados da Xtream se não tiver do TMDB
                        addDetailRow(detailsContainer, 'Lançamento', details.releasedate ? new Date(details.releasedate).toLocaleDateString() : 'N/A');
                        if (details.season_id !== undefined) {
                            addDetailRow(detailsContainer, 'Temporada', `Temporada ${details.season_id}`);
                            addDetailRow(detailsContainer, 'Episódio', `Episódio ${details.episode_num}`);
                        }
                        addDetailRow(detailsContainer, 'Título do Episódio', details.title || 'N/A');
                        addDetailRow(detailsContainer, 'Sinopse', details.plot || details.overview || 'N/A');
                    }
                } else if (type === 'live') {
                    addDetailRow(detailsContainer, 'Categoria', getCategoryName(item.category_id, cache.live_cat) || 'N/A');
                    if (details.current) {
                        addDetailRow(detailsContainer, 'Programa Atual', details.current.title || 'N/A');
                        addDetailRow(detailsContainer, 'Início', details.current.start ? new Date(details.current.start * 1000).toLocaleTimeString() : 'N/A');
                        addDetailRow(detailsContainer, 'Término', details.current.end ? new Date(details.current.end * 1000).toLocaleTimeString() : 'N/A');
                        addDetailRow(detailsContainer, 'Descrição', details.current.description || 'N/A');
                    } else {
                        addDetailRow(detailsContainer, 'Programa Atual', 'N/A');
                    }
                }
                
                // Adicionar informações do TMDB se disponíveis e for um filme
                if (type === 'vod' && tmdbData) {
                    const tmdbInfo = document.createElement('div');
                    tmdbInfo.className = 'tmdb-info';
                    
                    // Adicionar pôster do TMDB
                    if (tmdbData.poster_path) {
                        const posterImg = document.createElement('img');
                        posterImg.src = `${tmdbConfig.imageUrl}${tmdbData.poster_path}`;
                        posterImg.alt = tmdbData.title;
                        posterImg.style.maxWidth = '150px';
                        posterImg.style.borderRadius = '4px';
                        posterImg.style.marginRight = '1rem';
                        posterImg.style.float = 'left';
                        
                        tmdbInfo.appendChild(posterImg);
                    }
                    
                    // Adicionar tagline se disponível
                    if (tmdbData.tagline) {
                        const tagline = document.createElement('p');
                        tagline.style.fontStyle = 'italic';
                        tagline.style.marginBottom = '1rem';
                        tagline.textContent = tmdbData.tagline;
                        tmdbInfo.appendChild(tagline);
                    }
                    
                    detailsContainer.appendChild(tmdbInfo);
                }
                
            } catch (error) {
                console.error('Erro ao carregar detalhes:', error);
                detailsContainer.innerHTML = '<p class="error-message">Erro ao carregar detalhes do conteúdo.</p>';
            }
        }
        
        function addDetailRow(container, label, value) {
            const dt = document.createElement('dt');
            dt.textContent = label;
            container.appendChild(dt);
            
            const dd = document.createElement('dd');
            dd.textContent = value;
            container.appendChild(dd);
        }
        
        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else {
                return `${minutes}m`;
            }
        }
        
        function getCategoryName(categoryId, categories) {
            const category = categories.find(cat => cat.category_id == categoryId);
            return category ? category.category_name : null;
        }
        
        function addCustomControls(playerInstance) {
            const { plyr } = playerInstance.detail;
            const controls = plyr.elements.controls;
            const settingsBtn = controls.querySelector('[data-plyr="settings"]');
            
            if (!settingsBtn) return;
            
            // Botão de proporção de tela
            const aspectBtn = document.createElement('button');
            aspectBtn.type = 'button';
            aspectBtn.className = 'plyr__control plyr-aspect-ratio-btn';
            aspectBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21,3H3C1.9,3,1,3.9,1,5v14c0,1.1,0.9,2,2,2h18c1.1,0,2-0.9,2-2V5C23,3.9,22.1,3,21,3z M21,19H3V5h18V19z"/></svg>`;
            aspectBtn.title = "Aspect Ratio";
            
            let currentRatio = 0;
            const ratios = ['video-fit', 'video-fill', 'video-zoom'];
            
            aspectBtn.onclick = () => {
                const video = document.getElementById('video-player');
                video.classList.remove(ratios[currentRatio]);
                currentRatio = (currentRatio + 1) % ratios.length;
                video.classList.add(ratios[currentRatio]);
            };
            
            // Botões de sincronização de áudio
            const syncContainer = document.createElement('div');
            syncContainer.style.cssText = 'display:flex; gap:5px;';
            syncContainer.title = "Sincronia de Áudio";
            
            const syncMinus = document.createElement('button');
            syncMinus.className = 'plyr__control';
            syncMinus.innerHTML = `<i class="fa-solid fa-backward-fast"></i>`;
            syncMinus.onclick = () => { 
                const video = document.getElementById('video-player');
                video.currentTime -= 0.1; 
            };
            
            const syncPlus = document.createElement('button');
            syncPlus.className = 'plyr__control';
            syncPlus.innerHTML = `<i class="fa-solid fa-forward-fast"></i>`;
            syncPlus.onclick = () => { 
                const video = document.getElementById('video-player');
                video.currentTime += 0.1; 
            };
            
            syncContainer.append(syncMinus, syncPlus);
            
            // Inserir controles antes do botão de configurações
            controls.insertBefore(aspectBtn, settingsBtn);
            controls.insertBefore(syncContainer, settingsBtn);
            
            // Garantir que todos os botões sejam focáveis
            controls.querySelectorAll('button').forEach(btn => {
                btn.setAttribute('tabindex', '0');
            });
        }
        
        function showQualityModal() {
            const modal = document.getElementById('quality-modal');
            modal.classList.add('active');
            
            // Adicionar evento aos botões de qualidade
            modal.querySelectorAll('.quality-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const quality = btn.getAttribute('data-quality');
                    modal.classList.remove('active');
                    
                    // Reproduzir mídia com a qualidade selecionada
                    if (currentContent && currentContentType) {
                        playMedia(currentContent, currentContentType, quality);
                    }
                });
            });
        }
        
        // ==================== FAVORITOS ====================
        function getFavorites() {
            const favorites = localStorage.getItem('darkclarotv-favorites');
            return favorites ? JSON.parse(favorites) : [];
        }
        
        function saveFavorites(favorites) {
            localStorage.setItem('darkclarotv-favorites', JSON.stringify(favorites));
        }
        
        function toggleFavoriteItem(item, type, btnElement) {
            const favorites = getFavorites();
            const itemId = item.stream_id || item.id;
            const existingIndex = favorites.findIndex(fav => fav.id === itemId);
            
            if (existingIndex !== -1) {
                // Remover dos favoritos
                favorites.splice(existingIndex, 1);
                btnElement.classList.remove('active');
            } else {
                // Adicionar aos favoritos
                favorites.push({
                    id: itemId,
                    name: item.name,
                    type: type,
                    cover: item.stream_icon || item.cover || item.backdrop_path?.[0],
                    category_id: item.category_id
                });
                btnElement.classList.add('active');
            }
            
            saveFavorites(favorites);
        }
        
        function toggleFavorite() {
            if (!currentContent) return;
            
            const favoriteBtn = document.getElementById('favorite-btn');
            const favorites = getFavorites();
            const itemId = currentContent.stream_id || currentContent.id;
            const existingIndex = favorites.findIndex(fav => fav.id === itemId);
            
            if (existingIndex !== -1) {
                // Remover dos favoritos
                favorites.splice(existingIndex, 1);
                favoriteBtn.innerHTML = '<i class="far fa-heart"></i>';
            } else {
                // Adicionar aos favoritos
                favorites.push({
                    id: itemId,
                    name: currentContent.name,
                    type: currentContentType,
                    cover: currentContent.stream_icon || currentContent.cover || currentContent.backdrop_path?.[0],
                    category_id: currentContent.category_id
                });
                favoriteBtn.innerHTML = '<i class="fas fa-heart"></i>';
            }
            
            saveFavorites(favorites);
        }
        
        // ==================== PESQUISA ====================
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
            if (!searchTerm) return;
            
            // Coletar todos os itens de todas as categorias
            const allItems = [
                ...cache.live.map(item => ({ ...item, type: 'live' })),
                ...Object.values(cache.vod).flat().map(item => ({ ...item, type: 'vod' })),
                ...Object.values(cache.series).flat().map(item => ({ ...item, type: 'series' }))
            ];
            
            // Filtrar itens
            const filteredItems = allItems.filter(item => {
                return item.name.toLowerCase().includes(searchTerm);
            });
            
            // Exibir resultados
            displaySearchResults(filteredItems);
        }
        
        function displaySearchResults(items) {
            // Mudar para a tela principal
            showScreen('main-screen');
            
            // Esconder todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Criar seção de resultados
            let resultsSection = document.querySelector('.search-results-section');
            if (!resultsSection) {
                resultsSection = document.createElement('section');
                resultsSection.className = 'content-section search-results-section';
                resultsSection.innerHTML = `
                    <h2 class="section-title">Resultados da Pesquisa</h2>
                    <div class="content-grid" id="search-results"></div>
                `;
                document.querySelector('.content-container').appendChild(resultsSection);
            }
            
            resultsSection.classList.remove('hidden');
            
            const container = document.getElementById('search-results');
            container.innerHTML = '';
            
            if (items.length === 0) {
                container.innerHTML = '<p class="error-message">Nenhum resultado encontrado.</p>';
                return;
            }
            
            // Renderizar apenas os primeiros 20 itens para melhor performance
            const itemsToRender = items.slice(0, 20);
            itemsToRender.forEach(item => {
                const card = createContentCard(item, item.type);
                container.appendChild(card);
            });
            
            // Adicionar botão "Carregar mais" se houver mais itens
            if (items.length > 20) {
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.className = 'btn-primary';
                loadMoreBtn.textContent = 'Carregar mais';
                loadMoreBtn.style.marginTop = '1rem';
                loadMoreBtn.addEventListener('click', () => {
                    const currentCount = container.querySelectorAll('.content-card').length;
                    const nextItems = items.slice(currentCount, currentCount + 20);
                    nextItems.forEach(item => {
                        const card = createContentCard(item, item.type);
                        container.appendChild(card);
                    });
                    
                    // Se não houver mais itens, remover o botão
                    if (currentCount + nextItems.length >= items.length) {
                        loadMoreBtn.remove();
                    }
                });
                container.appendChild(loadMoreBtn);
            }
        }
        
        // ==================== PERFIL E CONFIGURAÇÕES ====================
        function loadProfileData() {
            const profileData = localStorage.getItem('darkclarotv-profile');
            if (profileData) {
                try {
                    currentProfile = JSON.parse(profileData);
                } catch (e) {
                    console.error('Erro ao carregar perfil:', e);
                    currentProfile = { name: '', server: '', username: '', password: '', tmdbApiKey: '', progress: {} };
                }
            }
        }
        
        function saveProfileData() {
            localStorage.setItem('darkclarotv-profile', JSON.stringify(currentProfile));
        }
        
        function handleLogout() {
            if (confirm('Tem certeza que deseja desconectar?')) {
                currentProfile = { name: '', server: '', username: '', password: '', tmdbApiKey: '', progress: {} };
                saveProfileData();
                showScreen('login-screen');
            }
        }
        
        // ==================== MODAL DE INFORMAÇÕES ====================
        function showInfoModal() {
            const modal = document.getElementById('info-modal');
            modal.classList.add('active');
        }
        
        // ==================== UTILITÁRIOS ====================
        function showError(message) {
            // Criar elemento de erro
            const errorElement = document.createElement('div');
            errorElement.className = 'error-message';
            errorElement.textContent = message;
            
            // Adicionar ao body
            document.body.appendChild(errorElement);
            
            // Posicionar no topo da tela
            errorElement.style.position = 'fixed';
            errorElement.style.top = '20px';
            errorElement.style.left = '50%';
            errorElement.style.transform = 'translateX(-50%)';
            errorElement.style.zIndex = '9999';
            errorElement.style.padding = '1rem';
            errorElement.style.borderRadius = '4px';
            errorElement.style.maxWidth = '80%';
            
            // Remover após 3 segundos
            setTimeout(() => {
                errorElement.remove();
            }, 3000);
        }
    </script>
</body>
</html>
